조남호 | Nathan-Cho<br>
07.10.23 ~ 진행중

# JPA
### 목차
1. [JPA란?](#1-jpa란)
2. [JPA 사용](#2-jpa-사용)
	> 2-1 [JPA 테이블 등록하기](#2-1-jpa-테이블-등록하기)<br>
	> 2-2 [EntityManager와 메소드들](#2-2-EntityManager와-메소드들)<br>
 	> 2-3 [조합키 사용](#2-3-조합키-사용)

***
## 1. JPA란?
    객체(JAVA)와 RDB의 패러다임 불일치 문제를 해소하기위해 RDB를 객체지향적으로 만들어 사용하자는
    취지에서 ORM이 탄생하였고 이 ORM을 사용하기 위한 JPA가 탄생하였다.

- ORM(Object Relational Mapping

      객체지향 언어와 관계형 DB와의 데이터를 매핑해주는 기술 (클래스와 테이블을 그대로 맵핑)
	    객체지향 언어와 관계형 DB는 서로 다른 구조를 가지고 있기 때문에
	    자바가 가지는 여러 이점을 제대로 사용할 수 없다.
	    이를 해결하고자 나온 기술이 테이블과 객체를 매핑시켜주는 ORM이다.
- JPA(JAVA Persistent API)

      자바에서 ORM을 사용하기 위한 표준 API(자바 전용)
      JPA는 인터페이스를 제공하는 역할을 하며 실질적인 ORM 기술을 구현해 놓은 것이 Hibernate같은 ORM
- Spring Data JPA

      JPA를 기반으로 만든 모듈이다
      Repository라는 인터페이스를 제공하여 DB와의 상호작용을 더 쉽고 간결하게 만들어준다.
      내부적으로는 JPA를 사용하기 때문에 JPA에 대한 선행학습이 필요하다.
- Hibernate

      ORM기술을 구현해 놓은 오픈소스 프레임워크이다.


***
## 2. JPA 사용
  		JPA와 관련하여 상당히 많은 수의 어노테이션이 추가되게 된다.
  		모든 어노테이션을 알필요는 없으나 중요한 어노테이션은 반드시 알아두고
  		JPA와 DB의 관계가 어떤식으로 되어있는지 이해가 중요하다.

### 2-1 JPA 테이블 등록하기
	테이블과 DB를 매핑시키기 위해서는 Entity어노테이션을 이용해 
 	Entity로 테이블을 등록시켜줘야 한다.

	아래는 테이블을 만들기 위해 사용할 수 있는 어노테이션들이며 
 	必은 반드시 사용해야하는 어노테이션이다.
 
@Entity(必)

	테이블을 Entity로 등록한다. 테이블 이름은 Entity의 이름과 동일하게 만들어진다.
  	엔티티를 만드는 순간 오류가 나게 되는 이유는
	테이블을 만들 때 반드시 필요한 PK가 없기 때문이다. 
	추가적으로 Entity는 기본생성자가 필수이다.
@Table

	엔티티와 매핑할 테이블을 지정한다. 
 	생략할 시 매핑한 엔티티의 이름을 테이블 이름으로 사용한다.

	name = 매핑할 테이블 이름
@Id(必)

	해당 필드를 PK칼럼으로 등록한다.
@GeneratedValue

	해당 컬럼에 자동 증가되는 값이 들어가게 된다.
@Column

	객체 필드를 테이블 컬럼에 매핑한다.

 	name : 테이블 컬럼의 이름
  	nullable : null값의 허용 여부를 결정한다. (true/false)
   	unique : 유니크 제약조건을 적용한다. (true/false)
	length : 문자 길이 제약조건이며 String 타입에만 사용한다. (Default 225)
	precision, scale : 숫자의 형태를 조절한다. BigDecimal 타입에서 사용한다.
				precision은 소숫점을 포함한 전체 자릿수이며
				scale은 소수의 자릿수이다.

@Enumerated

	JAVA의 enum 타입을 컬럼에 매핑하기위해 사용한다.

	EnumType.ORDINAL : enum 순서를 값으로 DB에 저장한다.
 	EnumType.STRING : enum 이름을 값으로 DB에 저장한다.
@Lob

	데이터베이스의 BLOB, CLOB, TEXT 타입과 매핑이 된다.

### 2-2 EntityManager와 메소드들
JPA를 통해서 CRUD하기 위해서는 JPA에 대한 구조적 이해가 필요하다.<br>
이는 영속성 컨텍스트와 밀접한 관련이 있으며 이것에 대해서는<br>
[3. JPA 구조](#3-jpa-구조)에서 확인한다.

@PersistenceContext

	영속성 컨텍스트를 사용할 수 있도록 한다.
EntityMangerFactory

	EntityManager를 만들고 구성하는 법을 제공하는 interface이다
EntityManager

	DB 테이블과 매핑된 Entity에 대한 CRUD를 수행하는 method를 제공하며 
 	Entity의 영속성과 생명주기를 관리, 담당한다.
- persist()

		DB의 INSERT에 해당하는 메소드이지만 그 작동방식이 다르다.
  		EntityManager에게 Entity를 넘겨줘서 영속화 시키고 INSERT쿼리를 생성해주는
  		메소드가 persist()이다. 이 메소드는 INSERT쿼리문을 작동시키는 것은 해당하지 않는다.
- flush()

		쿼리문을 DB에 반영한다. 하지만 COMMIT된 상태는 아니다.
  		@Transactional과 @Commit을 붙혀서 COMMIT까지 완료시킬 수 있다.  
- find()

		Entity의 클래스와 PK를 알려주면 해당 엔티티를 1차 캐시에서 찾아온다.
  		만약 1차 캐시에 존재하지 않을 경우 SELECT문을 통해 조회한다.
  		이 때, SELECT문의 결과를 가져오는 것이 아닌 1차 캐시에 영속화 시킨 후
  		그 영속화 된 데이터를 가져오는 것이다.
- detach()

    		영속성 컨텍스트에 등록된 엔티티를 영속성 컨텍스트에서 제외시켜
  		해당 데이터를 준영속 상태로 만든다
- remove()

		해당 데이터를 캐시와 DB에서 모두 삭제한다.
- merge()

		준영속 상태가 된 데이터를 다시 영속화 시킬 때 사용한다.

### 2-3 테이블 간 연관관계
	테이블간의 연관관계는 JPA의 테이블 매핑에 있어 매우 중요한 개념이며,
 	테이블 간의 관계를 맺어 사용할 수 있어야 한다.

#### 관련 어노테이션
@OneToMany

		일대다 관계 매핑
@ManyToOne

 		다대일 관계 매핑
@OneToOne

		일대일 관계 매핑
@ManyToMany

		다대다 관계 매핑
@JoinColumn

		Entity의 연관관계에서 외래 키를 매핑하기 위해 사용된다.
  		보통 일대다 관계에서 사용.

    		name : 매핑할 FK의 이름을 설정
@JoinTable

		다대다 관계에서 사용하며
  		다대다 간의 관계에서 생겨나는 새로운 TABLE이 엔티티없이 생겨나게 된다.

		name : 중간 테이블의 이름을 지정할 수 있다.
  		joinColumns : 두개의 테이블이 중간테이블에 연결될때의 이름을 각각 지정해줄 수 있다
    			joinColumn, inverseJoinColumns로 가능.

#### 단방향과 양방향
	단방향 구조와 양방향 구조는 두 테이블 사이에서 
 	서로가 한측만 참조하는지 서로를 참조하는지에 따라 달라진다.

   	단방향을 기본적으로 구현하고 필요에 따라서 양방향으로 구현하는 방향으로 가는 것이 좋다.
1. 단방향

		단방향의 경우에는 어느 테이블에 pk를 지정해줘도 상관이 없으나
		보통 FK가 생기는 테이블에 만들어주는 경우가 대부분이다. 하지만 단방향인 만큼
		한쪽에서밖에 참조를 할수 밖에 없으며 반대쪽에서는 불가능하다는 문제가 생긴다.
3. 양방향

		양방향의 경우에는 상호 테이블간의 모두 작성해주게 되지만
   		양방향 참조시 한쪽에서는 반드시 toString 제어를 해주어야만
   		StackOverFlow가 발생하지 않으며
   		한 테이블은 무조건 주인 테이블로서 존재해야하므로
   		반드시 주인 테이블이 아닌쪽에 mappedBY를 지정해주어야만 한다.
   		이렇듯 양방향은 상호 참조가 가능하다는 장점에도 불구하고 구현시
   		제어해야될게 많아지고 복잡해지므로 보통 잘 사용하지는 않는다.

### 2-3 조합키 사용
	요구에 따라 조합키로 만들어야 하는 경우가 있다. 
 	이럴 경우에는 조합키로 사용할 객체 필드들에 @Id를 걸어주는 것 뿐만 아니라 해야할 일들이 있다.

<img width="471" alt="스크린샷 2023-11-19 090259" src="https://github.com/DevNathan/study_jpa/assets/142222091/ef1cb000-b071-4c44-8f73-16ef510f52d1">

	조합키만 따로 모아둔 클래스를 하나를 새로 만들어야 한다.
 	반드시 기본생성자와 hashCode(), equals() 재정의가 필요하며
  	Serializable 마커 인터페이스를 구현해주어야 한다.

<img width="490" alt="스크린샷 2023-11-19 090341" src="https://github.com/DevNathan/study_jpa/assets/142222091/9c9af39a-4476-441a-8539-aa1ff90a506b">

	다시 돌아와서 클래스에 @IdClass를 붙혀주고 바로전에 만든 
 	조합키 클래스를 직접 연결해주며 N:1 관계를 잘 잡아주면 완성된다.


***
## 3. JPA 구조
	

***
## 4. JPQL
